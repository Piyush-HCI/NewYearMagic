<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Magical New Year</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Great+Vibes&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Henny+Penny&display=swap'); /* For Dobby */

        body {
            margin: 0;
            padding: 0;
            background-color: #0e0e0e;
            color: #d3a625;
            font-family: 'Cinzel', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
            text-align: center;
            background-image: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%);
        }

        /* --- UTILITIES --- */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 2s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- SCREEN 1: ONBOARDING --- */
        #onboarding-screen input, #onboarding-screen select {
            padding: 10px;
            margin: 10px;
            font-family: 'Cinzel', serif;
            background: rgba(0,0,0,0.7);
            border: 1px solid #d3a625;
            color: #fff;
            font-size: 1rem;
        }
        button {
            padding: 10px 20px;
            background: #740001; /* Gryffindor Red */
            color: #fff;
            border: 1px solid #d3a625;
            font-family: 'Cinzel', serif;
            cursor: pointer;
            margin-top: 20px;
            font-size: 1.2rem;
            transition: 0.3s;
        }
        button:hover { background: #4a0001; transform: scale(1.05); }

        /* --- SCREEN 2: DOBBY (LOCKED) --- */
        #dobby-screen {
            position: relative;
            max-width: 600px;
            margin: auto;
        }
        .dobby-img {
            height: 300px; /* Adjust based on your PNG */
            width: auto;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.2));
        }
        .speech-bubble {
            background: #fff;
            color: #000;
            font-family: 'Henny Penny', cursive; /* Playful/Dobby font */
            padding: 20px;
            border-radius: 20px;
            position: relative;
            margin-bottom: 20px;
            font-size: 1.1rem;
            max-width: 80%;
            margin-left: auto;
            margin-right: auto;
        }
        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 0;
            border: 20px solid transparent;
            border-top-color: #fff;
            border-bottom: 0;
            margin-left: -20px;
            margin-bottom: -20px;
        }

        /* --- SCREEN 3: FAT LADY (PASSWORD) --- */
        #fat-lady-screen {
            background: url('FatLady.jpg') no-repeat center center;
            background-size: cover;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* Input at bottom */
            align-items: center;
            padding-bottom: 100px;
            box-shadow: inset 0 0 100px #000;
        }
        .password-container {
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #d3a625;
        }

        /* --- SCREEN 4: GIFTS (UNLOCKED) --- */
        #gifts-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            z-index: 10;
        }
        .gift-item {
            width: 150px;
            height: 150px;
            perspective: 1000px;
            cursor: pointer;
        }
        
        /* Gift 1: Card Flip */
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        .card-inner.flipped { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #d3a625;
        }
        .card-front { background-color: #740001; color: white; }
        .card-back { 
            background-color: #f0e68c; 
            color: #000; 
            transform: rotateY(180deg); 
            font-size: 0.8rem; 
            padding: 5px;
            overflow-y: auto;
        }

        /* Gift 2: The Box (Cube) */
        .box-cube {
            width: 100px; height: 100px;
            background: #d3a625;
            margin: 25px auto;
            position: relative;
            transform: rotateZ(45deg);
            border: 2px solid #fff;
            box-shadow: 0 0 15px #d3a625;
        }
        .box-lid {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.2);
        }

        /* Gift 3: The Parcel */
        .parcel-shape {
            width: 120px; height: 120px;
            background: #444;
            border-radius: 50% 50% 50% 5%;
            margin: 15px auto;
            border: 3px dashed #888;
        }

        /* --- MODALS (For revealing content) --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100;
        }
        .parchment-bg {
            background: url('Parchment.png') no-repeat center center;
            background-size: contain;
            width: 80%; height: 80%;
            max-width: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #3e2723;
            font-family: 'Great Vibes', cursive;
            font-size: 1.5rem;
            text-align: center;
            line-height: 1.5;
        }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 2rem; color: #fff; cursor: pointer; }

        /* Canvas for fireworks */
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }

    </style>
</head>
<body>

    <audio id="bg-music" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>
    <div style="position: absolute; top: 10px; right: 10px; z-index: 100;">
        <button onclick="toggleMusic()" style="font-size: 0.8rem; padding: 5px;">ðŸŽµ Toggle Music</button>
    </div>

    <canvas id="fireworksCanvas"></canvas>

    <div id="onboarding-screen">
        <h1>Welcome, Traveler</h1>
        <p>Before you proceed, Dobby must know who you are.</p>
        <input type="text" id="user-name" placeholder="Your Name">
        <select id="user-gender">
            <option value="male">Wizard</option>
            <option value="female">Witch</option>
        </select>
        <br>
        <button onclick="submitOnboarding()">Enter</button>
    </div>

    <div id="dobby-screen" class="hidden">
        <div class="speech-bubble" id="dobby-text">
            </div>
        <img src="Dobby.png" alt="Dobby" class="dobby-img">
    </div>

    <div id="fat-lady-screen" class="hidden">
        <div class="password-container">
            <h2 style="margin: 0 0 10px 0;">Password?</h2>
            <input type="text" id="password-input" placeholder="Type the password..." style="width: 250px; padding: 10px;">
            <br>
            <button onclick="checkPassword()">Submit</button>
            <p id="password-error" style="color: red; display: none;">Strict, aren't we?</p>
        </div>
    </div>

    <div id="gifts-screen" class="hidden">
        <h1 class="fade-in">Happy New Year!</h1>
        <div id="gifts-container">
            
            <div class="gift-item" onclick="flipCard(this)">
                <div class="card-inner">
                    <div class="card-front">
                        <h3>A Greeting<br>(Tap to Flip)</h3>
                    </div>
                    <div class="card-back">
                        <p><strong>Prompt Used:</strong><br>[INSERT YOUR AI PROMPT HERE]</p>
                        <p style="font-size: 0.6rem; color: #555;">(Click again to close)</p>
                    </div>
                </div>
            </div>

            <div class="gift-item" onclick="openSnitch()">
                <div class="box-cube">
                    <div class="box-lid"></div>
                </div>
                <p style="font-size: 0.8rem; margin-top: -10px;">The Snitch</p>
            </div>

            <div class="gift-item" onclick="openCloak()">
                <div class="parcel-shape"></div>
                <p style="font-size: 0.8rem; margin-top: -10px;">A Parcel</p>
            </div>
        </div>
    </div>

    <div id="modal-overlay" class="modal hidden" onclick="closeModal()">
        <span class="close-btn">&times;</span>
        <div id="modal-content">
            </div>
    </div>

    <script>
        // CONFIGURATION
        // Set this to Jan 1, 2026 for the real event
        const targetDate = new Date("January 1, 2025 00:00:00").getTime(); 
        
        let userName = "";
        let userGender = "";
        const music = document.getElementById('bg-music');

        /* --- 1. ONBOARDING LOGIC --- */
        function submitOnboarding() {
            userName = document.getElementById('user-name').value.trim();
            userGender = document.getElementById('user-gender').value;

            if(!userName) { alert("Dobby needs a name!"); return; }

            document.getElementById('onboarding-screen').classList.add('hidden');
            checkTime();
        }

        /* --- 2. TIME & DOBBY LOGIC --- */
        function checkTime() {
            const now = new Date().getTime();
            
            // IF IT IS NOT YET TIME
            if (now < targetDate) {
                document.getElementById('dobby-screen').classList.remove('hidden');
                
                const dobbyText = document.getElementById('dobby-text');
                
                // Dobby Speak Logic
                if (userGender === 'male') {
                    dobbyText.innerHTML = `Dobby sees a wizard... Master ${userName} is being a bad boy! Dobby knows he is trying to open his gifts early! Dobby must not let him pass until the clock strikes twelve!`;
                } else {
                    dobbyText.innerHTML = `Dobby sees a witch... Miss ${userName} is being a bad girl! Dobby is thinking she is very sneaky trying to peek early. Dobby cannot let her pass!`;
                }
            } 
            // IF IT IS TIME
            else {
                document.getElementById('fat-lady-screen').classList.remove('hidden');
            }
        }

        /* --- 3. PASSWORD LOGIC --- */
        function checkPassword() {
            const input = document.getElementById('password-input').value.toLowerCase().trim();
            // Using "includes" to be slightly forgiving, but requiring the main phrase
            if (input.includes("solemnly swear that i am up to no good")) {
                document.getElementById('fat-lady-screen').classList.add('hidden');
                document.getElementById('gifts-screen').classList.remove('hidden');
                startFireworks(); // Boom!
            } else {
                document.getElementById('password-error').style.display = 'block';
                document.getElementById('password-error').innerText = "The Fat Lady says: 'No, that's not it!'";
            }
        }

        /* --- 4. GIFTS LOGIC --- */
        
        // Gift 1: Flip
        function flipCard(element) {
            const inner = element.querySelector('.card-inner');
            inner.classList.toggle('flipped');
        }

        // Gift 2: Snitch
        function openSnitch() {
            const modal = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');

            // Insert Snitch Quote on Parchment
            content.innerHTML = `
                <div class="parchment-bg">
                    <p>"Alright, um, now then, remember just because you made the team last year, that doesn't guarantee you a spot this year, is that clear?"<br><br>- Harry Potter</p>
                </div>
            `;
        }

        // Gift 3: Cloak
        function openCloak() {
            const modal = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');

            // Show Cloak Image + Dumbledore Quote
            content.innerHTML = `
                <img src="Cloak.jpg" style="max-width:80%; border-radius:10px; border:2px solid #d3a625;">
                <div style="background:rgba(0,0,0,0.8); padding:20px; border-radius:10px; margin-top:10px; color:#fff;">
                    <p>"Words are, in my not-so-humble opinion, our most inexhaustible source of magic. Capable of both inflicting injury, and remedying it."<br>- Albus Dumbledore</p>
                </div>
            `;
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
        }

        function toggleMusic() {
            if(music.paused) { music.play(); } else { music.pause(); }
        }

        /* --- FIREWORKS ENGINE --- */
        function startFireworks() {
            const canvas = document.getElementById("fireworksCanvas");
            const ctx = canvas.getContext("2d");
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            let particles = [];
            
            function animate() {
                requestAnimationFrame(animate);
                ctx.fillStyle = 'rgba(14, 14, 14, 0.1)'; 
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Add particles
                if (Math.random() < 0.1) {
                    const x = Math.random() * canvas.width;
                    const y = Math.random() * canvas.height;
                    const color = `hsl(${Math.random() * 360}, 50%, 50%)`;
                    for (let i = 0; i < 30; i++) {
                        particles.push({
                            x: x, y: y, color: color,
                            radius: Math.random() * 3,
                            velocity: { x: (Math.random()-0.5)*6, y: (Math.random()-0.5)*6 },
                            alpha: 1
                        });
                    }
                }

                particles.forEach((p, index) => {
                    if (p.alpha > 0) {
                        ctx.save(); ctx.globalAlpha = p.alpha; ctx.beginPath();
                        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                        ctx.fillStyle = p.color; ctx.fill(); ctx.restore();
                        p.x += p.velocity.x; p.y += p.velocity.y; p.alpha -= 0.02;
                    } else { particles.splice(index, 1); }
                });
            }
            animate();
        }
    </script>
</body>
</html>
